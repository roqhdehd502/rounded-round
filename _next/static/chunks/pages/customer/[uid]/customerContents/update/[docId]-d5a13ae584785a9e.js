(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{9372:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/customer/[uid]/customerContents/update/[docId]",function(){return t(5831)}])},5831:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return j}});var c=t(7568),o=t(655),i=t(5893),r=t(7294),a=t(9473),s=t(4045),u=t.n(s),l=t(1163),f=t(1153),h=t(9403),d=t(6094),m=t(3386),p=t(8918),g=t(424),b=t(9732),x=t(8070);function j(){var n=(0,a.I0)(),e=(0,l.useRouter)(),t=(0,a.v9)(function(n){return n.customerContentsInfo.customerContentObj}),s=(0,r.useState)(""),j=s[0],_=s[1],v=(0,r.useState)(""),y=v[0],C=v[1],N=(0,r.useState)(""),w=N[0],T=N[1],q=(0,r.useState)(null==t?void 0:t.contents),E=q[0],k=q[1],I=(0,r.useState)(""),U=I[0],S=I[1];(0,r.useEffect)(function(){n((0,x.lJ)(e.query.docId)),_(t?t.thumbnail:""),C(t?t.thumbnailUuid:""),T(t?t.title:""),k(t?t.contents:""),S(t?t.contents:"")},[e.query,t?t.docId:null]);var F,A,H,V=function(n,e){for(var t=[],c=0;c<n.length;c++){for(var o=n[c].split(","),i=o[0].match(/:(.*?);/)[1],r=i.substring(6,i.length),a=atob(o[1]),s=a.length,u=new Uint8Array(s);s--;)u[s]=a.charCodeAt(s);t.push(new File([u],"".concat(e,"_").concat(c,".").concat(r),{type:i}))}return t},Z=(F=(0,c.Z)(function(n,e,t,c){var i,r;return(0,o.__generator)(this,function(a){switch(a.label){case 0:i=function(i){var r;return(0,o.__generator)(this,function(o){switch(o.label){case 0:return r=f.iH(n,"customercontentsimages/".concat(c,"/").concat(t,"/").concat(t,"_").concat(i)),[4,f.KV(r,e[i]).then(function(n){console.log("thumbnail images ".concat(i),n)}).catch(function(n){console.log("contents image upload error!",n)})];case 1:return o.sent(),[2]}})},r=0,a.label=1;case 1:if(!(r<e.length))return[3,4];return[5,(0,o.__values)(i(r))];case 2:a.sent(),a.label=3;case 3:return r++,[3,1];case 4:return[2]}})}),function(n,e,t,c){return F.apply(this,arguments)}),z=(A=(0,c.Z)(function(n,e,t,c){var i,r,a;return(0,o.__generator)(this,function(o){switch(o.label){case 0:i=[],r=0,o.label=1;case 1:if(!(r<e.length))return[3,4];return a=f.iH(n,"customercontentsimages/".concat(c,"/").concat(t,"/").concat(t,"_").concat(r)),[4,f.Jt(a).then(function(n){i.push(n)}).catch(function(n){console.log("contents image download error!",n)})];case 2:o.sent(),o.label=3;case 3:return r++,[3,1];case 4:return[2,i]}})}),function(n,e,t,c){return A.apply(this,arguments)}),O=(0,r.useCallback)(function(t){if(""===t.contentTitle||""===t.contentContents){alert("제목 및 내용을 입력해주세요!");return}try{(0,g.V)({header:"회원 컨텐츠 수정",icon:"pi pi-exclamation-triangle",message:"정말 수정하시겠습니까?",position:"top",accept:(0,c.Z)(function(){var c,i,r,a,s,u,l,h,d;return(0,o.__generator)(this,function(o){switch(o.label){case 0:var m;if(c=f.cF(),i=document.querySelector("#photo-file").files[0],!((r=t.contentContents)!==t.beforeContentContents))return[3,3];if(m=t.contentContents,a=Array.from(m.matchAll(/<img[^>]+src=["']([^'">]+)['"]/gi)).map(function(n){return n.pop()||""}),console.log("extractBase64s",a,a.length),!a||!(-1!==a[0].indexOf(";base64,")))return[3,3];return s=V(a,t.contentThumbnailUuid),[4,Z(c,s,t.contentThumbnailUuid,e.query.uid)];case 1:return o.sent(),[4,z(c,s,t.contentThumbnailUuid,e.query.uid)];case 2:for(l=0,u=o.sent();l<s.length;l++)r=r.replaceAll(a[l],u[l]);o.label=3;case 3:return h={docId:e.query.docId,thumbnail:t.contentThumbnail,title:t.contentTitle,contents:r},d=f.iH(c,"customercontentsimages/".concat(e.query.uid,"/").concat(t.contentThumbnailUuid,"/").concat(t.contentThumbnailUuid)),i?f.KV(d,i).then(function(e){console.log("thumbnail image",e),f.Jt(d).then(function(e){h.thumbnail=e,n((0,x.X5)(h))})}).catch(function(n){console.log(n)}):n((0,x.X5)(h)),e.replace("/customer/".concat(e.query.uid,"/customerContents")),[2]}})}),reject:function(){}})}catch(i){console.log(i)}},[n]),X=(H=(0,c.Z)(function(){var c,i;return(0,o.__generator)(this,function(o){return c=f.cF(),i=f.iH(c,"customercontentsimages/".concat(e.query.uid,"/").concat(t.thumbnailUuid)),f.aF(i).then(function(t){t.items.forEach(function(n){var e=f.iH(c,"".concat(i.fullPath,"/").concat(n.name));f.oq(e).then(function(){console.log("DELETE IMAGE SUCCESS!")}).catch(function(n){console.log(n)})}),n((0,x.Ek)(e.query.docId))}).catch(function(t){console.log(t),n((0,x.Ek)(e.query.docId))}),[2]})}),function(){return H.apply(this,arguments)}),J=(0,r.useCallback)((0,c.Z)(function(){return(0,o.__generator)(this,function(n){try{(0,g.V)({header:"회원 컨텐츠 삭제",icon:"pi pi-exclamation-triangle",message:"정말 삭제하시겠습니까?",position:"top",accept:function(){X().then(function(){e.replace("/customer/".concat(e.query.uid,"/customerContents"))}).catch(function(n){console.log(n)})},reject:function(){}})}catch(t){console.log(t)}return[2]})}),[n]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.Q,{}),t?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:"flex align-content-center align-items-center justify-content-center form-vertical-align-center",children:(0,i.jsxs)("div",{className:"card surface-0 p-5 border-round-2xl w-8",children:[(0,i.jsx)("h1",{className:"flex justify-content-center",children:"유저 컨텐츠 수정"}),(0,i.jsxs)("div",{className:"field p-fluid mt-6",children:[(0,i.jsx)("label",{children:"썸네일"}),(0,i.jsx)("span",{className:"p-inputgroup",children:(0,i.jsx)("input",{id:"photo-file",type:"file",accept:"image/*",placeholder:"수정할 이미지를 업로드 하세요"})})]}),(0,i.jsxs)("div",{className:"field p-fluid mt-6",children:[(0,i.jsx)("label",{children:"제목"}),(0,i.jsx)("span",{className:"p-inputgroup",children:(0,i.jsx)(d.o,{value:w,onChange:function(n){return T(n.target.value)}})})]}),(0,i.jsxs)("div",{className:"field p-fluid mt-6",children:[(0,i.jsx)("label",{children:"내용"}),(0,i.jsx)("span",{className:"p-inputgroup",children:(0,i.jsx)(m.M,{className:"h-30rem w-full",value:E,onTextChange:function(n){return k(n.htmlValue)}})})]}),(0,i.jsx)("div",{className:"field p-fluid mt-8",children:(0,i.jsx)(h.z,{label:"수정하기",icon:"pi pi-user-edit",className:"pr-5",onClick:function(){return O({contentThumbnail:j,contentThumbnailUuid:y,contentTitle:w,contentContents:E,beforeContentContents:U})}})}),(0,i.jsx)(p.i,{}),(0,i.jsx)("div",{className:"field p-fluid",children:(0,i.jsx)(u(),{href:"/customer/".concat(e.query.uid,"/customerContents"),children:(0,i.jsx)(h.z,{label:"돌아가기",icon:"pi pi-arrow-left",className:"p-button-info pr-5"})})}),(0,i.jsx)("div",{className:"field p-fluid",children:(0,i.jsx)(u(),{href:"/",children:(0,i.jsx)(h.z,{label:"메인으로",icon:"pi pi-home",className:"p-button-info pr-5"})})}),(0,i.jsx)(p.i,{}),(0,i.jsx)("div",{className:"field p-fluid",children:(0,i.jsx)(h.z,{label:"삭제하기",icon:"pi pi-trash",className:"p-button-danger pr-5",onClick:function(){return J()}})})]})})}):(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(b.N,{})})]})}j.layout="L1"}},function(n){n.O(0,[861,494,774,888,179],function(){return n(n.s=9372)}),_N_E=n.O()}]);